---
layout: post
title:  "代码记录"
date:   2016-1-26 星期二  18:19:10    
categories: jekyll update
---


###清理服务器内存（慎用）###


	pkill java
	sync
	echo 3 > /proc/sys/vm/drop_caches




###html5代码###

显示高亮

	<pre class="brush:python;toolbar: true; auto-links: false;">   </pre>

引用

	<blockquote>  </blockquote>

表格代码

	<table border="1" cellspacing="0" cellpadding="2">
	<tbady>
	   <tr>
	   <td><strong>##</strong></td>
	   <td><strong>##</strong></td>
	   <td><strong>##</strong></td>
	</tr>
	<tr>
	   <td>##</td>
	   <td>##</td>
	   <td>##</td>
	</tr>
	<tr>
	   <td>##</td>
	   <td>##</td>
	   <td>##</td>
	</tr>
	</tbady>
	</table>

表格显示如下
<table border="1" cellspacing="0" cellpadding="2">
<tbady>
   <tr>
   <td><strong>##</strong></td>
   <td><strong>##</strong></td>
   <td><strong>##</strong></td>
</tr>
<tr>
   <td>##</td>
   <td>##</td>
   <td>##</td>
</tr>
<tr>
   <td>##</td>
   <td>##</td>
   <td>##</td>
</tr>
</tbady>
</table>

###查看“/”根下所有文件使用大小###


	du -sh /* --exclude="/proc" --exclude="/share"

###查看内存###

	dmidecode |grep -P -A5 "Memory\s+Device"|grep Size|grep -v Range|grep -cv 'No Module Installed'

###查询延时0.25秒以上的页面与IP###

THIS HOUR TOO SLOW: 0.274

	tail -1000 /usr/local/nginx/logs/access.log |awk '{print $7,$(NF-2),$NF}' | tr -d \" | awk '$3>0.25 {print $1,$2,$3}'

###延时两秒上的页面排名###

	tail -100000 access.log |awk '{print $7,$NF}' | tr -d \" | awk '$2>2 {print $1}' | sort | uniq -c |sort -nr  | head 

###rsync COPY ：###

	rsync -avzP --exclude=logs/ ./* IP:/tmp/
	rsync -avzP ./* IP:/tmp/

	只复制目录，不复制文件
	rsync -avp logs --include='*/' --exclude='*' IP:/tmp/

###查询前台某10分钟的日志###

	sed -n '/2015-02-27 19:30/,/2015-02-27 19:40/p' /www/logs/error.log

###查询某5分钟时间段的 日志条数###

	sed -n '/2015:14:20/,/2015:14:25/p' /usr/local/log/access.log|wc –l

###cisco ASA5545 VPN 查询登陆人数：###

	show ipsec sa detail | include username

###查询IP地址访问次数排名###

	tail -100000 /usr/local/nginx/logs/access.log|awk '{print $1}'|sort|uniq -c |sort -nr |head

###awk求平均值###

	#awk '{avg += ($1 - avg) / NR;} END { print avg; }'

###nginx新查询响应###

	for ip in `echo 192.168.1.115 192.168.1.116 192.168.1.75 192.168.0.139 192.168.1.64 192.168.0.51 192.168.0.53 192.168.0.60 192.168.0.12 192.168.0.55`;do echo $ip; tail -n 1000 /usr/local/nginx/logs/access.log |grep -w $ip |awk ' {print $NF }'| awk 'gsub(/\"/, "", $NF); {print $NF }' | awk '{count+=$NF} END{printf "%.3f\n",count * 1.0/NR } ';done

