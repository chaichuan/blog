---
layout: post
title:  "HP服务器收集磁盘日志"
date:   2015-12-22 星期二  10:30:52     
categories: jekyll update
---

###系统下安装如下ACU工具 按照下面命令来收集###

HP Array Configuration Utility CLI for Linux 64-bit

http://h20565.www2.hp.com/portal/site/hpsc/template.PAGE/public/psi/swdDetails/?sp4ts.oid=5177958&spf_p.tpst=swdMain&spf_p.prp_swdMain=wsrp-navigationalState%3Didx%253D%257CswItem%253DMTX_9a45caa3b8be46398c1bd4d016%257CswEnvOID%253D4103%257CitemLocale%253D%257CswLang%253D%257Cmode%253D%257Caction%253DdriverDocument&javax.portlet.begCacheTok=com.vignette.cachetoken&javax.portlet.endCacheTok=com.vignette.cachetoken


	rpm –ivh  hpacucli-9.40-12.0.x86_64


###查看磁盘状态，可以发现有块磁盘故障###

/usr/sbin/hpacucli ctrl slot=0 pd all show

	192.168.2.49 [~] 2015-12-22 10:03:17
	root@pts/0 # /usr/sbin/hpacucli ctrl slot=0 pd all show

	Smart Array P420i in Slot 0 (Embedded)

	   array A
	
      physicaldrive 1I:2:1 (port 1I:box 2:bay 1, SAS, 600 GB, Predictive Failure)
      physicaldrive 1I:2:2 (port 1I:box 2:bay 2, SAS, 600 GB, OK)
      physicaldrive 1I:2:3 (port 1I:box 2:bay 3, SAS, 600 GB, OK)
      physicaldrive 1I:2:4 (port 1I:box 2:bay 4, SAS, 600 GB, OK)
      physicaldrive 2I:2:5 (port 2I:box 2:bay 5, SAS, 600 GB, OK)
      physicaldrive 2I:2:6 (port 2I:box 2:bay 6, SAS, 600 GB, OK)
      physicaldrive 2I:2:7 (port 2I:box 2:bay 7, SAS, 600 GB, OK)
      physicaldrive 2I:2:8 (port 2I:box 2:bay 8, SAS, 600 GB, OK)


###查看raid状态###

/usr/sbin/hpacucli ctrl all show config detail


	192.168.2.49 [~] 2015-12-22 10:12:39
	root@pts/0 # /usr/sbin/hpacucli ctrl all show config detail

	Smart Array P420i in Slot 0 (Embedded)
	   Bus Interface: PCI
	   Slot: 0
	   Serial Number: 001438027ABAF70
	   Cache Serial Number: PBKUC0BRH5K0GJ
	   RAID 6 (ADG) Status: Enabled
	   Controller Status: OK
	   Hardware Revision: B
	   Firmware Version: 4.68
	   Rebuild Priority: Medium
	   Expand Priority: Medium
	   Surface Scan Delay: 15 secs
	   Surface Scan Mode: Idle
	   Queue Depth: Automatic
	   Monitor and Performance Delay: 60  min
	   Elevator Sort: Enabled
	   Degraded Performance Optimization: Disabled
	   Inconsistency Repair Policy: Disabled
	   Wait for Cache Room: Disabled
	   Surface Analysis Inconsistency Notification: Disabled
	   Post Prompt Timeout: 0 secs
	   Cache Board Present: True
	   Cache Status: OK
	   Cache Ratio: 10% Read / 90% Write
	   Drive Write Cache: Enabled
	   Total Cache Size: 1024 MB
	   Total Cache Memory Available: 816 MB
	   No-Battery Write Cache: Enabled
	   Cache Backup Power Source: Capacitors
	   Battery/Capacitor Count: 1
	   Battery/Capacitor Status: OK
	   SATA NCQ Supported: True
	   Spare Activation Mode: Activate on drive failure
	   Controller Temperature (C): 64
	   Cache Module Temperature (C): 32
	   Capacitor Temperature  (C): 24
	
	   Array: A
	      Interface Type: SAS
	      Unused Space: 0  MB
	      Status: OK
	      Array Type: Data
	
	
	
	      Logical Drive: 1
	         Size: 2.2 TB
	         Fault Tolerance: 1+0
	         Heads: 255
	         Sectors Per Track: 63
	         Cylinders: 65535
	         Strip Size: 256 KB
	         Full Stripe Size: 1024 KB
	         Status: OK
	         Caching:  Enabled
	         Unique Identifier: 600508B1001C0A0D1D39FCC928C7A1B0
	         Disk Name: /dev/sda
	         Mount Points: /boot 500 MB, / 2.2 TB, /swap 2.0 GB
	         OS Status: LOCKED
	         Logical Drive Label: A213EB0F50014380225C71D00877
	         Mirror Group 0:
	            physicaldrive 1I:2:1 (port 1I:box 2:bay 1, SAS, 600 GB, Predictive Failure)
	            physicaldrive 1I:2:2 (port 1I:box 2:bay 2, SAS, 600 GB, OK)
	            physicaldrive 1I:2:3 (port 1I:box 2:bay 3, SAS, 600 GB, OK)
	            physicaldrive 1I:2:4 (port 1I:box 2:bay 4, SAS, 600 GB, OK)
	         Mirror Group 1:
	            physicaldrive 2I:2:5 (port 2I:box 2:bay 5, SAS, 600 GB, OK)
	            physicaldrive 2I:2:6 (port 2I:box 2:bay 6, SAS, 600 GB, OK)
	            physicaldrive 2I:2:7 (port 2I:box 2:bay 7, SAS, 600 GB, OK)
	            physicaldrive 2I:2:8 (port 2I:box 2:bay 8, SAS, 600 GB, OK)
	         Drive Type: Data
	         Caching Association: None

	      physicaldrive 1I:2:1
	         Port: 1I
	         Box: 2
	         Bay: 1
	         Status: Predictive Failure
	         Drive Type: Data Drive
	         Interface Type: SAS
	         Size: 600 GB
	         Rotational Speed: 10500
	         Firmware Revision: HPD3
	         Serial Number: S0M142J90000N4101DFZ
	         Model: HP      EG0600FCVBK     
	         Current Temperature (C): 30
	         Maximum Temperature (C): 51
	         PHY Count: 2
	         PHY Transfer Rate: 6.0Gbps, Unknown
	         Drive Authentication Status: OK
	         Carrier Application Version: 11
	         Carrier Bootloader Version: 6
	
	      physicaldrive 1I:2:2
	         Port: 1I
	         Box: 2
	         Bay: 2
	         Status: OK
	         Drive Type: Data Drive
	         Interface Type: SAS
	         Size: 600 GB
	         Rotational Speed: 10000
	         Firmware Revision: HPD0
	         Serial Number: 85M0A0J6FTM21534
	         Model: HP      EG0600FCSPL     
	         Current Temperature (C): 30
	         Maximum Temperature (C): 34
	         PHY Count: 2
	         PHY Transfer Rate: 6.0Gbps, Unknown
	         Drive Authentication Status: OK
	         Carrier Application Version: 11
	         Carrier Bootloader Version: 6
	
	      physicaldrive 1I:2:3
	         Port: 1I
	         Box: 2
	         Bay: 3
	         Status: OK
	         Drive Type: Data Drive
	         Interface Type: SAS
	         Size: 600 GB
	         Rotational Speed: 10500
	         Firmware Revision: HPD3
	         Serial Number: S0M14YFT0000B410E6X9
	         Model: HP      EG0600FCVBK     
	         Current Temperature (C): 31
	         Maximum Temperature (C): 57
	         PHY Count: 2
	         PHY Transfer Rate: 6.0Gbps, Unknown
	         Drive Authentication Status: OK
	         Carrier Application Version: 11
	         Carrier Bootloader Version: 6
	
	      physicaldrive 1I:2:4
	         Port: 1I
	         Box: 2
	         Bay: 4
	         Status: OK
	         Drive Type: Data Drive
	         Interface Type: SAS
	         Size: 600 GB
	         Rotational Speed: 10500
	         Firmware Revision: HPD3
	         Serial Number: S0M153KL0000B410CN1H
	         Model: HP      EG0600FCVBK     
	         Current Temperature (C): 32
	         Maximum Temperature (C): 54
	         PHY Count: 2
	         PHY Transfer Rate: 6.0Gbps, Unknown
	         Drive Authentication Status: OK
	         Carrier Application Version: 11
	         Carrier Bootloader Version: 6
	
	      physicaldrive 2I:2:5
	         Port: 2I
	         Box: 2
	         Bay: 5
	         Status: OK
	         Drive Type: Data Drive
	         Interface Type: SAS
	         Size: 600 GB
	         Rotational Speed: 10500
	         Firmware Revision: HPD3
	         Serial Number: S0M14BAM0000B410CEW5
	         Model: HP      EG0600FCVBK     
	         Current Temperature (C): 30
	         Maximum Temperature (C): 50
	         PHY Count: 2
	         PHY Transfer Rate: 6.0Gbps, Unknown
	         Drive Authentication Status: OK
	         Carrier Application Version: 11
	         Carrier Bootloader Version: 6
	
	      physicaldrive 2I:2:6
	         Port: 2I
	         Box: 2
	         Bay: 6
	         Status: OK
	         Drive Type: Data Drive
	         Interface Type: SAS
	         Size: 600 GB
	         Rotational Speed: 10500
	         Firmware Revision: HPD3
	         Serial Number: S0M154JR0000B410DWPR
	         Model: HP      EG0600FCVBK     
	         Current Temperature (C): 30
	         Maximum Temperature (C): 55
	         PHY Count: 2
	         PHY Transfer Rate: 6.0Gbps, Unknown
	         Drive Authentication Status: OK
	         Carrier Application Version: 11
	         Carrier Bootloader Version: 6
	
	      physicaldrive 2I:2:7
	         Port: 2I
	         Box: 2
	         Bay: 7
	         Status: OK
	         Drive Type: Data Drive
	         Interface Type: SAS
	         Size: 600 GB
	         Rotational Speed: 10500
	         Firmware Revision: HPD3
	         Serial Number: S0M153XT0000B410CLFL
	         Model: HP      EG0600FCVBK     
	         Current Temperature (C): 31
	         Maximum Temperature (C): 55
	         PHY Count: 2
	         PHY Transfer Rate: 6.0Gbps, Unknown
	         Drive Authentication Status: OK
	         Carrier Application Version: 11
	         Carrier Bootloader Version: 6
	
	      physicaldrive 2I:2:8
	         Port: 2I
	         Box: 2
	         Bay: 8
	         Status: OK
	         Drive Type: Data Drive
	         Interface Type: SAS
	         Size: 600 GB
	         Rotational Speed: 10500
	         Firmware Revision: HPD3
	         Serial Number: S0M14YV60000B410E770
	         Model: HP      EG0600FCVBK     
	         Current Temperature (C): 32
	         Maximum Temperature (C): 53
	         PHY Count: 2
	         PHY Transfer Rate: 6.0Gbps, Unknown
	         Drive Authentication Status: OK
	         Carrier Application Version: 11
	         Carrier Bootloader Version: 6
	
	
	   SEP (Vendor ID PMCSIERA, Model SRCv8x6G) 380
	      Device Number: 380
	      Firmware Version: RevB
	      WWID: 5001438027ABAF7F
	      Vendor ID: PMCSIERA
	      Model: SRCv8x6G        

###抓取磁盘日志###

	192.168.2.49 [/tmp] 2015-12-22 10:26:49
	root@pts/0 # hpacucli 
	HP Array Configuration Utility CLI 9.40.12.0
	Detecting Controllers...Done.
	Type "help" for a list of supported commands.
	Type "exit" to close the console.
	
	=> ctrl all diag file=2_49.zip   //file后边 自定义文件名.zip
	
	   Generating diagnostic report...done
	
	=> exit
	192.168.2.49 [/tmp] 2015-12-22 10:27:28
	root@pts/0 # ll 2_49.zip     //日志就在本目录下
	-rw-r--r-- 1 root root 140400 Dec 22 10:27 2_49.zip


