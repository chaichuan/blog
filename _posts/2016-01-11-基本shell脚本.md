---
layout: post
title:  "基本shell脚本"
date:   2016-1-11 星期一  23:15:05 
categories: jekyll update
---


###一、创建和运行shell###


在创建shell文件时，必须在文件第一行指定要使用的shell，其格式为：


	#!/bin/bash


例如：


	Test_2 [~] 2015-10-12 22:51:57
	root@pts/0 # cat test     
	#!/bin/bash
	date
	Test_2 [~] 2015-10-12 22:52:05
	root@pts/0 # ./test 
	Mon Oct 12 22:52:11 GMT 2015



显示消息，如果在同一行显示一个文本字符串作为命令输出，可以用echo语句的 -n 参数：



	Test_2 [/opt/shell] 2015-10-12 22:59:44
	root@pts/0 # cat t1.sh 
	#!/bin/bash
	echo -n "the time:";date
	
	Test_2 [/opt/shell] 2015-10-12 22:59:46
	root@pts/0 # ./t1.sh 
	the time:Mon Oct 12 22:59:51 GMT 2015



使用变量，反引号允许将shell命令的输出赋给变量：




	Test_2 [/opt/shell] 2015-10-12 23:08:35
	root@pts/0 # cat t1.sh               
	#!/bin/bash
	time=`date +%Y%m%d-%H:%M:%S`	##用户变量$time
	echo "time is $time"
	echo "this is logged $USER"		##环境变量$USER
	Test_2 [/opt/shell] 2015-10-12 23:08:40
	root@pts/0 # ./t1.sh 
	time is 20151012-23:08:48
	this is logged root



重定向输出与输入：



	Test_2 [/opt/shell] 2015-10-12 23:11:31
	root@pts/0 # date > file
	Test_2 [/opt/shell] 2015-10-12 23:11:42
	root@pts/0 # cat file 
	Mon Oct 12 23:11:42 GMT 2015
	Test_2 [/opt/shell] 2015-10-12 23:11:45
	root@pts/0 # w >> file		##双'>>'在文本后追加
	Test_2 [/opt/shell] 2015-10-12 23:11:54
	root@pts/0 # cat file 
	Mon Oct 12 23:11:42 GMT 2015
	23:11:54 up  1:26,  1 user,  load average: 0.00, 0.00, 0.00
	USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT
	root     pts/0    192.168.23.1     22:45    0.00s  0.21s  0.05s w
	Test_2 [/opt/shell] 2015-10-12 23:11:57
	root@pts/0 # wc < file 
	  4  32 225		##wc命令对文本进行计数，行数、词数、字节数
	Test_2 [/opt/shell] 2015-10-12 23:13:08
	root@pts/0 # wc << eof		##以 eof开头 与 eof结尾
	> test1
	> test2
	> test3
	> eof
	 3  3 18
	Test_2 [/opt/shell] 2015-10-12 23:15:08
	root@pts/0 # cat file |grep root		##管道符号
	root     pts/0    192.168.23.1     22:45    0.00s  0.21s  0.05s w




###二、改变shell脚本中程序的流程###




if - then - else语句，不管命令是否成功，只有一个选择：




	Test_2 [/opt/shell] 2015-10-12 23:27:01
	root@pts/0 # cat t2.sh 
	#!/bin/bash
	up="/etc/passwd"
	if grep wo $up ;then
	echo "user is mi"
	else
	echo "user is not mi"
	fi
	Test_2 [/opt/shell] 2015-10-12 23:27:06
	root@pts/0 # ./t2.sh 
	user is not mi




嵌套if，检查脚本代码中的多种条件，if - then - elif：





	if command1;then
	command set 1
	elif command2;then
	command set 2
	elif command3;then
	command set 3
	fi




test命令，提供了在if - then 语句中测试不同条件的途径：



	if [ condition ];then
	commands
	fi




test命令可以判断3类条件：



	数值比较；
	字符串比较；
	文件比较。



test命令的数值比较功能：



<table border="1" cellspacing="0" cellpadding="2">
<tbady>
   <tr>
   <td><strong>比较</strong></td>
   <td><strong>描述</strong></td>
</tr>
<tr>
   <td>n1 -eq n2</td>
   <td>检查是否相等</td>
</tr>
<tr>
   <td>n1 -ge n2</td>
   <td>检查n1是否大于或等于n2</td>
</tr>
<tr>
   <td>n1 -gt n2</td>
   <td>检查n1是否大于n2</td>
</tr>
<tr>
   <td>n1 -le n2</td>
   <td>检查n1是否小于或等于n2</td>
</tr>
<tr>
   <td>n1 -lt n2</td>
   <td>检查n1是否小于n2</td>
</tr>
<tr>
   <td>n1 -ne n2</td>
   <td>检查n1是否不等于n2</td>
</tr>
</tbady>
</table>
	

	
test命令的字符串比较功能：


<table border="1" cellspacing="0" cellpadding="2">
<tbady>
   <tr>
   <td><strong>比较</strong></td>
   <td><strong>描述</strong></td>
</tr>
<tr>
   <td>str1 = str2</td>
   <td>检查str1是否和str2相同</td>
</tr>
<tr>
   <td>str1 != str2</td>
   <td>检查str1是否和str2不同</td>
</tr>
<tr>
   <td>str1 < str2</td>
   <td>检查str1是否比str2小</td>
</tr>
<tr>
   <td>str1 > str2</td>
   <td>检查str1是否比str2大</td>
</tr>
<tr>
   <td>-n str1</td>
   <td>检查str1的长度是否非0</td>
</tr>
<tr>
   <td>-z str1</td>
   <td>检查str1的长度是否为0</td>
</tr>
</tbady>
</table>



			



> 说明：

> 不等的字符串条件也允许判断值是否相等，如：[ $USER != $yonghu ],标点与大小写也会比较；

> 大于小于符号必须转义，否则shell会当做重定向符号，如：[ $var1 \> $var2 ]；

> test命令中，大写字母会被当成小于小写字母的，另外，字符串比较用数学比较符（>、<、=），数值比较用文本代码（eq、gt、lt）。



test命令的文件比较功能：



<table border="1" cellspacing="0" cellpadding="2">
<tbady>
   <tr>
   <td><strong>比较</strong></td>
   <td><strong>描述</strong></td>
</tr>
<tr>
   <td>-d file</td>
   <td>检查file是否存在并是一个目录</td>
</tr>
<tr>
   <td>-e file</td>
   <td>检查file是否存在</td>
</tr>
<tr>
   <td>-f file</td>
   <td>检查file是否存在并是一个文件</td>
</tr>
<tr>
   <td>-r file</td>
   <td>检查file文件是否存在并可读</td>
</tr>
<tr>
   <td>-s file</td>
   <td>检查file文件是否存在并非空</td>
</tr>
<tr>
   <td>-w file</td>
   <td>检查file文件是否存在并可写</td>
</tr>
<tr>
   <td>-x file</td>
   <td>检查file文件是否存在并可执行</td>
</tr>
<tr>
   <td>-O file</td>
   <td>检查file文件是否存在并属当前用户所有</td>
</tr>
<tr>
   <td>-G file</td>
   <td>检查file文件是否存在并且默认组与当前用户相同</td>
</tr>
<tr>
   <td>file1 -nt file2</td>
   <td>检查file1是否比file2新</td>
</tr>
<tr>
   <td>file1 -ot file2</td>
   <td>检查file1是否比file2旧</td>
</tr>
</tbady>
</table>



复合条件测试，即布尔逻辑组合测试，有两种：





	1. [ condition1 ]&&[ condition2 ]		##使用and组合条件，两个条件都必须满足

	2. [ condition1 ]||[ condition2 ]		##使用or组合条件，满足任意条件



if - then 的高级特性：



(( expression ))使用双圆括号可以是任意数学赋值或比较表达式



<table border="1" cellspacing="0" cellpadding="2">
<tbady>
   <tr>
   <td><strong>符号</strong></td>
   <td><strong>描述</strong></td>
</tr>
<tr>
   <td>val++</td>
   <td>后增</td>
</tr>
<tr>
   <td>val--</td>
   <td>后减</td>
</tr>
<tr>
   <td>++val</td>
   <td>先增</td>
</tr>
<tr>
   <td>--val</td>
   <td>先减</td>
</tr>
<tr>
   <td>!</td>
   <td>逻辑求反</td>
</tr>
<tr>
   <td>~</td>
   <td>位求反</td>
</tr>
<tr>
   <td>**</td>
   <td>幂运算</td>
</tr>
<tr>
   <td><<</td>
   <td>左位移</td>
</tr>
<tr>
   <td>>></td>
   <td>右位移</td>
</tr>
<tr>
   <td>&</td>
   <td>位布尔和</td>
</tr>
<tr>
   <td>|</td>
   <td>位布尔或</td>
</tr>
<tr>
   <td>&&</td>
   <td>逻辑和</td>
</tr>
<tr>
   <td>||</td>
   <td>逻辑或</td>
</tr>
</tbady>
</table>		


			


>注意：

>不需要将双圆括号中表达式里的大于号转义




[[ expression ]]使用双方括号针对字符串比较，比test命令提供了另一特性-匹配模式[[ $USER == r* ]]



case命令，提供了一个更清晰的方法来为变量每个可能的值指定不同的选项：



	Test_2 [/opt/shell] 2015-10-13 00:53:44
	root@pts/0 # cat t4.sh 
	#!/bin/bash
	numb="$1"		##脚本后边跟的第一个字符
	case $numb in
	test)
	echo "this is test";;
	chai)
	echo "this is chai";;
	root)
	echo "this is root";;
	*)				##星号匹配没有列出的值
	echo "thsi is null";;
	esac
	Test_2 [/opt/shell] 2015-10-13 00:53:51
	root@pts/0 # ./t4.sh chai
	this is chai
	Test_2 [/opt/shell] 2015-10-13 00:54:02
	root@pts/0 # ./t4.sh ssss
	thsi is null



###三、迭代代码片段###

for命令

	for var in list
	do
		commands
	done

> 说明：也可以将do语句与for语句放在同一行，但必须用分号将其同列表中的值分开

	for var in lisr;do


读取列表中的值

	root@pts/0 # cat test.sh 
	#!/bin/bash
	for t in ak m4 wam
	do
		echo the test in $t
	done
	Test_1 [/opt] 2016-01-11 14:55:57
	root@pts/0 # bash test.sh 
	the test in ak
	the test in m4
	the test in wam

读取列表中的复杂值

	root@pts/0 # cat t2.sh 
	#!/bin/bash
	for t in I don\'t know if "this'll" work
	do
		echo the test in $t
	done
	Test_1 [/opt] 2016-01-11 14:58:25
	root@pts/0 # bash t2.sh 
	the test in I
	the test in don't
	the test in know
	the test in if
	the test in this'll
	the test in work



> 使用转义字符（反斜线）来将单引号转义

> 使用双引号来定义用到单引号的值，也可以定义有空格的值。

	root@pts/0 # cat 1.sh 
	#!/bin/bash
	for t in I "don't" know if "chai chuan"  work
	do
		echo the test in $t
	done
	Test_1 [/opt] 2016-01-11 15:04:44
	root@pts/0 # bash 1.sh 
	the test in I
	the test in don't
	the test in know
	the test in if
	the test in chai chuan
	the test in work


从变量读取列表
	
	root@pts/0 # cat 2.sh 
	#!/bin/bash
	list="1 2 3"
	for t in $list
	do
		echo the test in $t
	done
	Test_1 [/opt] 2016-01-11 15:09:17
	root@pts/0 # bash 2.sh 
	the test in 1
	the test in 2
	the test in 3

从命令读取值

	root@pts/0 # cat num 
	1
	2
	3
	Test_1 [/opt] 2016-01-11 15:12:24
	root@pts/0 # cat 1.sh 
	#!/bin/bash
	for t in `cat /opt/num`
	do
		echo the test in $t
	done
	Test_1 [/opt] 2016-01-11 15:12:28
	root@pts/0 # bash 1.sh 
	the test in 1
	the test in 2
	the test in 3

十二章




###四、在脚本中处理用户输入的数据###



###五、脚本中存储和显示数据的不同方法###



###六、控制脚本在系统中运行###














