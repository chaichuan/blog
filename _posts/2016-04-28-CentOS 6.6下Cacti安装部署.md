---
layout: post
title:  "CentOS 6.6下Cacti安装部署"
date:   2016-4-28 14:53:14 
categories: jekyll update
---

###部署cacti运行环境###

	root@pts/0 # yum -y install httpd mysql mysql-server mysql-devel php php-mysql
	root@pts/0 # yum -y install zlib freetype libjpeg fontconfig libxml2 gd php-gd
	root@pts/0 # yum -y install rrdtool
	root@pts/0 # yum -y install net-snmp net-snmp-utils

###启动安装服务并加开机启动###

	root@pts/0 # service httpd start
	正在启动 httpd：                                           [确定]
	root@pts/0 # chkconfig httpd on 
	root@pts/0 # service mysqld start
	初始化 MySQL 数据库： Installing MySQL system tables...
	OK
	Filling help tables...
	OK
	
	To start mysqld at boot time you have to copy
	support-files/mysql.server to the right place for your system
	
	PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !
	To do so, start the server, then issue the following commands:
	
	/usr/bin/mysqladmin -u root password 'new-password'
	/usr/bin/mysqladmin -u root -h 192.168.68.220 password 'new-password'
	
	Alternatively you can run:
	/usr/bin/mysql_secure_installation
	
	which will also give you the option of removing the test
	databases and anonymous user created by default.  This is
	strongly recommended for production servers.
	
	See the manual for more instructions.
	
	You can start the MySQL daemon with:
	cd /usr ; /usr/bin/mysqld_safe &
	
	You can test the MySQL daemon with mysql-test-run.pl
	cd /usr/mysql-test ; perl mysql-test-run.pl
	
	Please report any problems with the /usr/bin/mysqlbug script!
	
	                                                           [确定]
	正在启动 mysqld：                                          [确定]
	root@pts/0 # chkconfig mysqld on
	root@pts/0 # service snmpd start
	正在启动 snmpd：                                           [确定]
	root@pts/0 # chkconfig snmpd on

###安装cacti###

cacti官网：[http://www.cacti.net](http://www.cacti.net "http://www.cacti.net")

选择版本进行下载

	root@pts/0 # wget http://www.cacti.net/downloads/cacti-0.8.8g.tar.gz

####安装####

	root@pts/0 # tar -xf cacti-0.8.8g.tar.gz -C /var/www/html/
	root@pts/0 # cd /var/www/html/
	root@pts/0 # mv cacti-0.8.8g cacti
	
cacti配置

	root@pts/0 # vim cacti/include/config.php
	......
	$database_type = "mysql";
	$database_default = "cacti";
	$database_hostname = "localhost";
	$database_username = "cactiuser";
	$database_password = "123456";
	$database_port = "3306";
	$database_ssl = false;
	......

mysql配置

	root@pts/0 # mysql
	Welcome to the MySQL monitor.  Commands end with ; or \g.
	Your MySQL connection id is 2
	Server version: 5.1.73 Source distribution
	
	Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.
	
	Oracle is a registered trademark of Oracle Corporation and/or its
	affiliates. Other names may be trademarks of their respective
	owners.
	
	Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
	
	mysql> create database cacti;
	Query OK, 1 row affected (0.00 sec)
	
	mysql> grant all on cacti.* to 'cactiuser'@'localhost' identified by '123456';
	Query OK, 0 rows affected (0.00 sec)
	
	mysql> flush privileges;
	Query OK, 0 rows affected (0.00 sec)
	
	mysql> exit
	Bye
	
	root@pts/0 # mysqladmin -u root password '123456'

创建账户并加权限

	root@pts/0 # chown -R root.root cacti
	root@pts/0 # useradd cacti
	root@pts/0 # chown -R cacti.cacti cacti/log cacti/rra/

导入cacti.sql

	root@pts/0 # mysql -u root -p cacti < /var/www/html/cacti/cacti.sql

或者

	进入数据库导入cacti数据结构
	# mysql
	mysql> use cacti;
	mysql> source /var/www/html/cacti/cacti.sql;
	注意观察导入时是否报错，如无报错退出即可。

在浏览器输入http://localhost/cacti/install/，进入cacti安装向导

查看http error_log，助于排查问题

	root@pts/0 # tail -f /var/log/httpd/error_log  

错误1：

	[Thu Apr 28 09:04:31 2016] [error] [client 192.168.120.226] PHP Warning:  date(): It is not safe to rely on the system's timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected 'UTC' for 'GMT/0.0/no DST' instead in /var/www/html/cacti/include/global_constants.php on line 169

解决：

以上说明php 时区错误，在php.ini中设置date.timezone的值为PRC，设置好以后的为：date.timezone = PRC，同时取消这一行代码的注释，即去掉前面的分号。
再重启apache

	root@pts/0 # vim /etc/php.ini
	......
	date.timezone = PRC
	......

错误2：

	[Thu Apr 28 17:20:15 2016] [error] [client 192.168.120.226] PHP Fatal error:  Allowed memory size of 1073741824 bytes exhausted (tried to allocate 523800 bytes) in /var/www/html/cacti/lib/adodb/adodb.inc.php on line 833

解决：

需要导入cacti.sql文件

	mysql -u root -p cacti < /var/www/html/cacti/cacti.sql

接着安装

![](http://7xppz2.com1.z0.glb.clouddn.com/57.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/58.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/59.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/60.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/61.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/62.png)

