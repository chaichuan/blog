---
layout: post
title:  "HP D6000 盘柜配置"
date:   2015-12-23 星期三  16:48:37     
categories: jekyll update
---


###基础设施###



> HP DL380 Gen8 服务器  System:Centos_6.3

> HP Smart Array P431/2G Controller

> HP D6000 盘柜

P431卡插入服务器PCI-E插槽，通过 SAS线 把盘柜与服务器连接

![](http://7xppz2.com1.z0.glb.clouddn.com/4.JPG)


###配置RAID6###
重启服务器，按F5进入P431卡配置界面

![](http://7xppz2.com1.z0.glb.clouddn.com/2.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/9.png)

开始配置，配置RAID6

![](http://7xppz2.com1.z0.glb.clouddn.com/10.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/11.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/12.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/13.png)


缓存配置10%：90% 读写

![](http://7xppz2.com1.z0.glb.clouddn.com/14.png)

![](http://7xppz2.com1.z0.glb.clouddn.com/15.png)

###服务器配置###

#####下载驱动#####
http://h20566.www2.hpe.com/hpsc/swd/public/readIndex?sp4ts.oid=5404574&swLangOid=2&swEnvOid=4103

kmod-hpsa-3.4.12-110.rhel6u3.x86_64.rpm
rhel6U3代表6.3

####安装驱动：#####

	root@pts/0 # rpm -ivh kmod-hpsa-3.4.12-110.rhel6u3.x86_64.rpm 
	Preparing...                ########################################### [100%]
	   1:kmod-hpsa              ########################################### [100%]
	安装完重启：
	root@pts/0 # reboot 
	
	Broadcast message from root@192.168.2.145
	        (/dev/pts/0) at 13:07 ...
	
	The system is going down for reboot NOW!
	
#####重启后识别/dev/sdb：#####

	192.168.2.145 [~] 2015-12-23 13:12:05
	root@pts/0 # fdisk -l
	
	WARNING: GPT (GUID Partition Table) detected on '/dev/sda'! The util fdisk doesn't support GPT. Use GNU Parted.
	
	
	Disk /dev/sda: 2400.4 GB, 2400374185984 bytes
	255 heads, 63 sectors/track, 291828 cylinders
	Units = cylinders of 16065 * 512 = 8225280 bytes
	Sector size (logical/physical): 512 bytes / 512 bytes
	I/O size (minimum/optimal): 262144 bytes / 1048576 bytes
	Disk identifier: 0x00000000
	
	   Device Boot      Start         End      Blocks   Id  System
	/dev/sda1               1      267350  2147483647+  ee  GPT
	Partition 1 does not start on physical sector boundary.
	
	Disk /dev/sdb: 198037.7 GB, 198037652201472 bytes
	255 heads, 63 sectors/track, 24076706 cylinders
	Units = cylinders of 16065 * 512 = 8225280 bytes
	Sector size (logical/physical): 512 bytes / 512 bytes
	I/O size (minimum/optimal): 262144 bytes / 8650752 bytes
	Disk identifier: 0x5b6077a7
	
#####分区：#####

	192.168.2.145 [~] 2015-12-23 13:20:17
	root@pts/0 # parted /dev/sdb 
	GNU Parted 2.1
	Using /dev/sdb
	Welcome to GNU Parted! Type 'help' to view a list of commands.
	(parted) mklabel gpt
	(parted) mkpart primary 0% 100%                                           
	(parted) print                                                            
	Model: HP LOGICAL VOLUME (scsi)
	Disk /dev/sdb: 198TB
	Sector size (logical/physical): 512B/512B
	Partition Table: gpt
	
	Number  Start   End    Size   File system  Name     Flags
	 1      8651kB  198TB  198TB               primary
	
	(parted) quit                                                             
	Information: You may need to update /etc/fstab.                           
	
#####格式化：#####

	root@pts/0 # yum install xfsprogs kmod-xfs 
	Loaded plugins: fastestmirror, security
	Determining fastest mirrors
	epel/metalink                                                                                                     | 4.6 kB     00:00     
	 * base: mirrors.yun-idc.com
	 * epel: mirrors.yun-idc.com
	 * extras: mirrors.yun-idc.com
	 * updates: mirrors.btte.net
	base                                                                                                              | 3.7 kB     00:00     
	base/primary_db                                                                                                   | 4.6 MB     00:00     
	dell-omsa-indep                                                                                                   | 1.9 kB     00:00     
	dell-omsa-specific                                                                                                | 1.9 kB     00:00     
	epel                                                                                                              | 4.3 kB     00:00     
	epel/primary_db                                                                                                   | 5.7 MB     00:00     
	extras                                                                                                            | 2.9 kB     00:00     
	extras/primary_db                                                                                                 |  33 kB     00:00     
	updates                                                                                                           | 3.4 kB     00:00     
	updates/primary_db                                                                                                | 3.3 MB     00:00     
	Setting up Install Process
	No package kmod-xfs available.
	Resolving Dependencies
	--> Running transaction check
	---> Package xfsprogs.x86_64 0:3.1.1-16.el6 will be installed
	--> Finished Dependency Resolution

	Dependencies Resolved

	=========================================================================================================================================
	 Package                          Arch                           Version                              Repository                    Size
	=========================================================================================================================================
	Installing:
	 xfsprogs                         x86_64                         3.1.1-16.el6                         base                         724 k

	Transaction Summary
	=========================================================================================================================================
	Install       1 Package(s)

	Total download size: 724 k
	Installed size: 3.2 M
	Is this ok [y/N]: y
	Downloading Packages:
	xfsprogs-3.1.1-16.el6.x86_64.rpm                                                                                  | 724 kB     00:00     
	Running rpm_check_debug
	Running Transaction Test
	Transaction Test Succeeded
	Running Transaction
	Warning: RPMDB altered outside of yum.
	** Found 4 pre-existing rpmdb problem(s), 'yum check' output follows:
	iproute-2.6.32-17.el6.x86_64 has missing requires of iptables >= ('0', '1.4.5', None)
	iproute-2.6.32-17.el6.x86_64 has missing requires of libxtables.so.4()(64bit)
	system-config-firewall-base-1.2.27-5.el6.noarch has missing requires of iptables >= ('0', '1.2.8', None)
	system-config-firewall-base-1.2.27-5.el6.noarch has missing requires of iptables-ipv6
	  Installing : xfsprogs-3.1.1-16.el6.x86_64                                                                                          1/1 

	Installed:
	  xfsprogs.x86_64 0:3.1.1-16.el6                                                                                                         

	Complete!
	192.168.2.145 [~] 2015-12-23 13:26:56
	root@pts/0 # mkfs.xfs /dev/sdb1     
	meta-data=/dev/sdb1              isize=256    agcount=181, agsize=268435392 blks
	         =                       sectsz=512   attr=2, projid32bit=0
	data     =                       bsize=4096   blocks=48349033920, imaxpct=1
	         =                       sunit=64     swidth=2112 blks
	naming   =version 2              bsize=4096   ascii-ci=0
	log      =internal log           bsize=4096   blocks=521728, version=2
	         =                       sectsz=512   sunit=64 blks, lazy-count=1
	realtime =none                   extsz=4096   blocks=0, rtextents=0
	
#####挂载：#####

	192.168.2.145 [~] 2015-12-23 13:28:57
	root@pts/0 # mkdir /back
	192.168.2.145 [~] 2015-12-23 13:29:09
	root@pts/0 # mount -t xfs /dev/sdb1 /back/
	192.168.2.145 [~] 2015-12-23 13:29:33
	root@pts/0 # df -h
	Filesystem            Size  Used Avail Use% Mounted on
	/dev/sda2             2.2T  2.9G  2.1T   1% /
	tmpfs                  32G     0   32G   0% /dev/shm
	/dev/sda1             485M   36M  424M   8% /boot
	/dev/sda3             2.0G   35M  1.8G   2% /swap
	192.168.0.71:/vol/vol2
	                      2.0T  368G  1.6T  19% /share
	/dev/sdb1             181T   38M  181T   1% /back

#####测试：#####

	192.168.2.145 [~] 2015-12-23 13:29:34
	root@pts/0 # cd /back/
	192.168.2.145 [/back] 2015-12-23 13:29:52
	root@pts/0 # ll
	total 0
	192.168.2.145 [/back] 2015-12-23 13:29:53
	root@pts/0 # touch chai
	192.168.2.145 [/back] 2015-12-23 13:30:14
	root@pts/0 # ll
	total 0
	-rw-r--r-- 1 root root 0 Dec 23 13:30 chai
	192.168.2.145 [/back] 2015-12-23 13:30:15
	root@pts/0 # rm chai 
	192.168.2.145 [/back] 2015-12-23 13:30:23
	root@pts/0 # ll
	total 0
	
#####查看raid信息：#####

	/usr/sbin/hpacucli ctrl all show config detail

#####查看磁盘信息：#####

	/usr/sbin/hpacucli ctrl slot=0 pd all show 